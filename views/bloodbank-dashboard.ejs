<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blood Bank Dashboard - Blood Bank System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      @keyframes slideIn {
        from { opacity: 0; transform: translateX(-20px); }
        to { opacity: 1; transform: translateX(0); }
      }
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
      }
      .animate-fadeIn {
        animation: fadeIn 0.6s ease-out;
      }
      .animate-slideIn {
        animation: slideIn 0.6s ease-out;
      }
      .animate-pulse-slow {
        animation: pulse 2s ease-in-out infinite;
      }
      .gradient-text {
        background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
      .stat-card {
        background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
        transition: all 0.3s ease;
      }
      .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }
      .blood-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        font-weight: bold;
        font-size: 1rem;
        background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
        color: white;
        box-shadow: 0 4px 6px -1px rgba(220, 38, 38, 0.3);
        transition: all 0.3s ease;
      }
      .blood-badge:hover {
        transform: scale(1.1);
        box-shadow: 0 10px 15px -3px rgba(220, 38, 38, 0.4);
      }
      .table-row-hover {
        transition: all 0.2s ease;
      }
      .table-row-hover:hover {
        background-color: #fef2f2;
        transform: scale(1.01);
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-red-50 via-pink-50 to-red-100 min-h-screen">
    <!-- Animated Background -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
      <div class="absolute top-20 left-10 w-96 h-96 bg-red-200 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse-slow"></div>
      <div class="absolute top-40 right-10 w-96 h-96 bg-pink-200 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse-slow" style="animation-delay: 1s;"></div>
    </div>

    <!-- Success/Error Alerts -->
    <% if (typeof success !== 'undefined' && success) { %>
      <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 fixed top-0 left-0 right-0 z-50 shadow-lg animate-fadeIn" role="alert">
        <div class="flex items-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
          </svg>
          <p class="font-bold">Success!</p>
          <p class="ml-2"><%= success %></p>
        </div>
      </div>
    <% } %>
    
    <% if (typeof error !== 'undefined' && error) { %>
      <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 fixed top-0 left-0 right-0 z-50 shadow-lg animate-fadeIn" role="alert">
        <div class="flex items-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
          </svg>
          <p class="font-bold">Error!</p>
          <p class="ml-2"><%= error %></p>
        </div>
      </div>
    <% } %>

    <!-- Navigation -->
    <nav class="bg-white/90 backdrop-blur-md shadow-lg sticky tp-0 z-40 border-b border-red-100">
      <div class="container mx-auto px-6 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div class="relative">
              <div class="absolute inset-0 bg-red-600 rounded-full blur-lg opacity-30 animate-pulse"></div>
              <div class="relative bg-gradient-to-br from-red-500 to-red-700 p-2 rounded-xl shadow-lg">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4"></path>
                </svg>
              </div>
            </div>
            <h1 class="text-2xl font-bold gradient-text">Blood Bank Dashboard</h1>
          </div>

          <div class="flex items-center space-x-6">
            <a href="/" class="text-gray-700 hover:text-red-600 font-medium transition-colors duration-200">Home</a>
            <a href="/request/allRequests" class="text-gray-700 hover:text-red-600 font-medium transition-colors duration-200">All Requests</a>
            <a href="/profile" class="text-gray-700 hover:text-red-600 font-medium transition-colors duration-200">Profile</a>
            <div class="flex items-center space-x-2">
              <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              <span class="text-sm text-gray-600 font-medium"><%= (user && user.email) || 'User' %></span>
            </div>
            <a href="/logout" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-all duration-200 transform hover:scale-105">Logout</a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-6 pt-8 relative z-10">
      <!-- Header Section -->
      <div class="mb-8 animate-fadeIn">
        <div class="bg-white rounded-2xl shadow-xl p-6 card-hover">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-3xl font-bold gradient-text mb-2">
                Welcome to Your Dashboard
              </h2>
              <p class="text-gray-600">Manage your blood inventory and donations efficiently</p>
            </div>
            <% if (typeof bank !== 'undefined' && bank) { %>
              <div>
                <% if (bank.isVerified) { %>
                  <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-green-100 text-green-800 shadow-md">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    Verified Account
                  </span>
                <% } else { %>
                  <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-yellow-100 text-yellow-800 shadow-md">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    Pending Verification
                  </span>
                <% } %>
              </div>
            <% } %>
          </div>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div
          class="bg-white rounded-lg shadow-md p-6 border-l-4 border-red-500"
        >
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-600 text-sm">Total Inventory Units</p>
              <p class="text-3xl font-bold text-gray-800 mt-2">
                <%
                let totalInventory = 0;
                if (typeof inventory !== 'undefined' && inventory) {
                  inventory.forEach(function(item) {
                    totalInventory += (item.quantity || 0);
                  });
                }
                %>
                <%= totalInventory %>
              </p>
            </div>
            <div class="bg-red-100 rounded-full p-3">
              <svg
                class="w-8 h-8 text-red-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
                ></path>
              </svg>
            </div>
          </div>
        </div>

        <div
          class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500"
        >
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-600 text-sm">Donation Appointments</p>
              <p class="text-3xl font-bold text-gray-800 mt-2">
                <%= typeof donations !== 'undefined' && donations ? donations.length : 0 %>
              </p>
            </div>
            <div class="bg-blue-100 rounded-full p-3">
              <svg
                class="w-8 h-8 text-blue-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
            </div>
          </div>
        </div>

        <div
          class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500"
        >
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-600 text-sm">Pending Requests</p>
              <p class="text-3xl font-bold text-gray-800 mt-2">
                <%
                let pendingCount = 0;
                if (typeof requests !== 'undefined' && requests) {
                  requests.forEach(function(r) {
                    if (r.status === 'pending') pendingCount++;
                  });
                }
                %>
                <%= pendingCount %>
              </p>
            </div>
            <div class="bg-green-100 rounded-full p-3">
              <svg
                class="w-8 h-8 text-green-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                ></path>
              </svg>
            </div>
          </div>
        </div>

        <div
          class="bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500"
        >
          <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-600 text-sm">Registered Donors</p>
                <p class="text-3xl font-bold text-gray-800 mt-2">
                    <%# Use the direct count variable, which is guaranteed to be a number %>
                    <%= registeredDonorsCount || 0 %>
                </p>
            </div>
            <div class="bg-purple-100 rounded-full p-3">
              <svg
                class="w-8 h-8 text-purple-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
                ></path>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Blood Inventory Table -->
      <div class="bg-white rounded-lg shadow-md overflow-hidden mb-8">
        <div class="px-6 py-4 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <h3 class="text-xl font-bold text-gray-800 flex items-center">
              <svg
                class="w-6 h-6 text-red-600 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
                ></path>
              </svg>
              Blood Inventory
            </h3>
            <div class="flex space-x-2">
              <button onclick="openBulkUpdateModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium">
                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                Bulk Update
              </button>
              <button onclick="refreshInventory()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors text-sm font-medium">
                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                Refresh
              </button>
            </div>
          </div>
        </div>

        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Blood Group
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Quantity (Units)
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Status
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Last Updated
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Actions
                </th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% if (typeof inventory !== 'undefined' && inventory && inventory.length > 0) { %>
                <% const bloodGroups = ['A+', 'A-', 'B+', 'B-', 'O+', 'O-', 'AB+', 'AB-']; %>
                <% bloodGroups.forEach(function(bg) {
                  let item = null;
                  for (let i = 0; i < inventory.length; i++) {
                    if (inventory[i].bloodGroup === bg) {
                      item = inventory[i];
                      break;
                    }
                  }
                %>
                  <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span
                        class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800"
                      >
                        <%= bg %>
                      </span>
                    </td>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
                    >
                      <%= item ? item.quantity : 0 %> units
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <%
                      const status = item && item.quantity > 0 ? 'available' : 'low';
                      let statusClass;
                      if (item && item.quantity > 20) {
                        statusClass = 'bg-green-100 text-green-800';
                      } else if (item && item.quantity > 10) {
                        statusClass = 'bg-yellow-100 text-yellow-800';
                      } else {
                        statusClass = 'bg-red-100 text-red-800';
                      }
                      %>
                      <span
                        class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%= statusClass %>"
                      >
                        <%= status %>
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                      <% if (item && item.lastUpdated) { %>
                        <%= new Date(item.lastUpdated).toLocaleDateString() %>
                      <% } else { %>
                        N/A
                      <% } %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                      <div class="flex space-x-2">
                        <button data-bloodgroup="<%= bg %>" data-quantity="<%= item ? item.quantity : 0 %>"  onclick="openUpdateModal(this.dataset.bloodgroup, this.dataset.quantity)" class="text-blue-600 hover:text-blue-900 font-medium">
                          <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                          </svg>
                          Edit
                        </button>
                        <button onclick="quickAddStock('<%= bg %>')" class="text-green-600 hover:text-green-900 font-medium">
                          <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                          </svg>
                          Add
                        </button>
                      </div>
                    </td>
                  </tr>
                <% }); %>
              <% } else { %>
                <tr>
                  <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                    No inventory data available
                  </td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Blood Requests from Hospitals -->
      <div class="bg-white rounded-lg shadow-md overflow-hidden mb-8">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-xl font-bold text-gray-800 flex items-center">
            <svg
              class="w-6 h-6 text-red-600 mr-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
              ></path>
            </svg>
            Blood Requests from Hospitals
          </h3>
        </div>

        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Hospital
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Blood Group
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Units
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Urgency
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Status
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Date
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  Actions
                </th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% if (typeof requests !== 'undefined' && requests && requests.length > 0) { %>
                <% requests.forEach(function(request) { %>
                  <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      <%= (request.requestedBy && request.requestedBy.name) || request.hospitalName || 'Hospital' %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span
                        class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800"
                      >
                        <%= request.bloodGroup %>
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      <%= request.unitsRequired || request.units || 'N/A' %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <%
                      const urgencyClass = {
                        'low': 'bg-green-100 text-green-800',
                        'medium': 'bg-yellow-100 text-yellow-800',
                        'high': 'bg-orange-100 text-orange-800',
                        'critical': 'bg-red-100 text-red-800'
                      };
                      %>
                      <span
                        class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%= urgencyClass[request.urgency] || 'bg-gray-100 text-gray-800' %>"
                      >
                        <%= request.urgency || 'N/A' %>
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <%
                      const statusClass = {
                        'pending': 'bg-yellow-100 text-yellow-800',
                        'approved': 'bg-green-100 text-green-800',
                        'fulfilled': 'bg-blue-100 text-blue-800',
                        'rejected': 'bg-red-100 text-red-800',
                        'cancelled': 'bg-gray-100 text-gray-800'
                      };
                      %>
                      <span
                        class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%= statusClass[request.status] || 'bg-gray-100 text-gray-800' %>"
                      >
                        <%= request.status || 'N/A' %>
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                      <% if (request.createdAt) { %>
                        <%= new Date(request.createdAt).toLocaleDateString() %>
                      <% } else { %>
                        N/A
                      <% } %>
                    </td>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2"
                    >
                      <% if (request.status === 'pending') { %>
                        <form
                          action="/request/requestStatus"
                          method="POST"
                          style="display: inline"
                        >
                          <input
                            type="hidden"
                            name="requestId"
                            value="<%= request._id %>"
                          />
                          <button
                            type="submit"
                            name="status"
                            value="approved"
                            class="text-green-600 hover:text-green-900 bg-green-50 px-3 py-1 rounded"
                          >
                            Approve
                          </button>
                        </form>
                        <form
                          action="/request/requestStatus"
                          method="POST"
                          style="display: inline"
                        >
                          <input
                            type="hidden"
                            name="requestId"
                            value="<%= request._id %>"
                          />
                          <button
                            type="submit"
                            name="status"
                            value="rejected"
                            class="text-red-600 hover:text-red-900 bg-red-50 px-3 py-1 rounded"
                          >
                            Reject
                          </button>
                        </form>
                      <% } else if (request.status === 'approved') { %>
                        <form
                          action="/request/requestStatus"
                          method="POST"
                          style="display: inline"
                        >
                          <input
                            type="hidden"
                            name="requestId"
                            value="<%= request._id %>"
                          />
                          <button
                            type="submit"
                            name="status"
                            value="fulfilled"
                            class="text-blue-600 hover:text-blue-900 bg-blue-50 px-3 py-1 rounded"
                            onclick="return confirm('Are you sure you want to fulfill this request? This will deduct <%= request.unitsRequired || request.units %> units of <%= request.bloodGroup %> from your inventory.')"
                          >
                            Fulfill
                          </button>
                        </form>
                      <% } %>
                    </td>
                  </tr>
                <% }); %>
              <% } else { %>
                <tr>
                  <td colspan="7" class="px-6 py-4 text-center text-gray-500">
                    No blood requests from hospitals at the moment
                  </td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Donation Appointments -->
<div class="bg-white rounded-lg shadow-md overflow-hidden">
  <div class="px-6 py-4 border-b border-gray-200">
    <h3 class="text-xl font-bold text-gray-800 flex items-center">
      <svg
        class="w-6 h-6 text-red-600 mr-2"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
        ></path>
      </svg>
      Donation Appointments
    </h3>
  </div>

  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Donor Name
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Blood Group
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Date
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Status
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Actions
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <% if (typeof donations !== 'undefined' && donations && donations.length > 0) { %>
          <% donations.forEach(function(donation) { %>
            <tr class="hover:bg-gray-50">
              <td
                class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
              >
                <% if (donation.donor) { %>
                  <%= donation.donor.fullName || 'Donor' %>
                <% } else { %>
                  <%= donation.donorName || 'Donor' %>
                <% } %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span
                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800"
                >
                  <%= donation.bloodGroup %>
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <% if (donation.donationDate) { %>
                  <%= new Date(donation.donationDate).toLocaleDateString() %>
                <% } else if (donation.date) { %>
                  <%= new Date(donation.date).toLocaleDateString() %>
                <% } else { %>
                  N/A
                <% } %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <%
                const donationStatusClass = {
                  'scheduled': 'bg-blue-100 text-blue-800',
                  'completed': 'bg-green-100 text-green-800',
                  'cancelled': 'bg-red-100 text-red-800',
                  'rejected': 'bg-gray-100 text-gray-800'
                };
                %>
                <span
                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%= donationStatusClass[donation.status] || 'bg-gray-100 text-gray-800' %>"
                >
                  <%= donation.status || 'N/A' %>
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <div class="flex space-x-2">
                  <% if (donation.status === 'scheduled') { %>
                    <form
                      action="/donation/<%= donation._id %>/status"
                      method="POST"
                      style="display: inline"
                    >
                      <button
                        type="submit"
                        name="status"
                        value="completed"
                        class="text-green-600 hover:text-green-900 bg-green-50 px-3 py-1 rounded transition-colors"
                        onclick="return confirm('Mark this donation as completed? This will add <%= donation.quantity || 1 %> unit(s) of <%= donation.bloodGroup %> to your inventory.')"
                      >
                        Complete
                      </button>
                    </form>
                    <form
                      action="/donation/<%= donation._id %>/status"
                      method="POST"
                      style="display: inline"
                    >
                      <button
                        type="submit"
                        name="status"
                        value="cancelled"
                        class="text-red-600 hover:text-red-900 bg-red-50 px-3 py-1 rounded transition-colors"
                        onclick="return confirm('Cancel this donation appointment?')"
                      >
                        Cancel
                      </button>
                    </form>
                  <% } else if (donation.status === 'completed') { %>
                    <span class="text-green-600 bg-green-50 px-3 py-1 rounded">Completed</span>
                  <% } else if (donation.status === 'cancelled') { %>
                    <span class="text-red-600 bg-red-50 px-3 py-1 rounded">Cancelled</span>
                  <% } %>
                  <button
                    onclick="viewDonationDetails('<%= donation._id %>')"
                    class="text-blue-600 hover:text-blue-900 bg-blue-50 px-3 py-1 rounded transition-colors flex items-center"
                  >
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                    Details
                  </button>
                </div>
              </td>
            </tr>
          <% }); %>
        <% } else { %>
          <tr>
            <td colspan="5" class="px-6 py-4 text-center text-gray-500">
              No donation appointments scheduled
            </td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-12">
      <div class="container mx-auto px-6 text-center">
        <p>&copy; 2025 Blood Bank Management System. All rights reserved.</p>
      </div>
    </footer>

    <!-- Inventory Update Modal -->
    <div id="updateModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full z-50">
      <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-lg bg-white">
        <div class="mt-3">
          <h3 class="text-lg font-bold text-gray-900 mb-4">Update Inventory</h3>
          <form id="updateForm">
            <input type="hidden" id="updateBloodGroup" name="bloodGroup">
            <div class="mb-4">
              <label class="block text-gray-700 text-sm font-bold mb-2">Current Quantity:</label>
              <input type="text" id="currentQuantity" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight" readonly>
            </div>
            <div class="mb-4">
              <label class="block text-gray-700 text-sm font-bold mb-2">Operation:</label>
              <select id="operation" name="operation" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight">
                <option value="set">Set Exact Quantity</option>
                <option value="add">Add Units</option>
                <option value="remove">Remove Units</option>
              </select>
            </div>
            <div class="mb-4">
              <label class="block text-gray-700 text-sm font-bold mb-2">Quantity:</label>
              <input type="number" id="updateQuantity" name="quantity" min="0" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight" required>
            </div>
            <div class="flex justify-end space-x-2">
              <button type="button" onclick="closeUpdateModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Cancel</button>
              <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Update</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Bulk Update Modal -->
    <div id="bulkUpdateModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full z-50">
      <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-lg bg-white">
        <div class="mt-3">
          <h3 class="text-lg font-bold text-gray-900 mb-4">Bulk Update Inventory</h3>
          <form id="bulkUpdateForm">
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <label class="text-sm font-medium">A+:</label>
                <input type="number" name="A+" min="0" class="w-24 px-2 py-1 border rounded" value="0">
              </div>
              <div class="flex items-center justify-between">
                <label class="text-sm font-medium">A-:</label>
                <input type="number" name="A-" min="0" class="w-24 px-2 py-1 border rounded" value="0">
              </div>
              <div class="flex items-center justify-between">
                <label class="text-sm font-medium">B+:</label>
                <input type="number" name="B+" min="0" class="w-24 px-2 py-1 border rounded" value="0">
              </div>
              <div class="flex items-center justify-between">
                <label class="text-sm font-medium">B-:</label>
                <input type="number" name="B-" min="0" class="w-24 px-2 py-1 border rounded" value="0">
              </div>
              <div class="flex items-center justify-between">
                <label class="text-sm font-medium">O+:</label>
                <input type="number" name="O+" min="0" class="w-24 px-2 py-1 border rounded" value="0">
              </div>
              <div class="flex items-center justify-between">
                <label class="text-sm font-medium">O-:</label>
                <input type="number" name="O-" min="0" class="w-24 px-2 py-1 border rounded" value="0">
              </div>
              <div class="flex items-center justify-between">
                <label class="text-sm font-medium">AB+:</label>
                <input type="number" name="AB+" min="0" class="w-24 px-2 py-1 border rounded" value="0">
              </div>
              <div class="flex items-center justify-between">
                <label class="text-sm font-medium">AB-:</label>
                <input type="number" name="AB-" min="0" class="w-24 px-2 py-1 border rounded" value="0">
              </div>
            </div>
            <div class="flex justify-end space-x-2 mt-4">
              <button type="button" onclick="closeBulkUpdateModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Cancel</button>
              <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Update All</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Donation Details Modal -->
<div id="donationDetailsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full z-50">
  <div class="relative top-10 mx-auto p-5 border w-full max-w-3xl shadow-lg rounded-lg bg-white my-8">
    <div class="mt-3">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-2xl font-bold text-gray-900">Donation Details</h3>
        <button onclick="closeDonationDetailsModal()" class="text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div id="donationDetailsContent" class="space-y-6">
        <!-- Loading state -->
        <div class="text-center py-8">
          <svg class="animate-spin h-8 w-8 mx-auto text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <p class="mt-2 text-gray-600">Loading donation details...</p>
        </div>
      </div>
    </div>
  </div>
</div>

    <script>
      const bankId = '<%= user.id %>';

      function openUpdateModal(bloodGroup, currentQuantity) {
        document.getElementById('updateBloodGroup').value = bloodGroup;
        document.getElementById('currentQuantity').value = currentQuantity;
        document.getElementById('updateModal').classList.remove('hidden');
      }

      function closeUpdateModal() {
        document.getElementById('updateModal').classList.add('hidden');
        document.getElementById('updateForm').reset();
      }

      function openBulkUpdateModal() {
        document.getElementById('bulkUpdateModal').classList.remove('hidden');
      }

      function closeBulkUpdateModal() {
        document.getElementById('bulkUpdateModal').classList.add('hidden');
        document.getElementById('bulkUpdateForm').reset();
      }

      function quickAddStock(bloodGroup) {
        document.getElementById('updateBloodGroup').value = bloodGroup;
        document.getElementById('operation').value = 'add';
        document.getElementById('updateQuantity').value = '1';
        document.getElementById('updateModal').classList.remove('hidden');
      }

      function refreshInventory() {
        window.location.reload();
      }

      // Handle single inventory update
      document.getElementById('updateForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = {
          bloodGroup: formData.get('bloodGroup'),
          operation: formData.get('operation'),
          quantity: parseInt(formData.get('quantity'), 10)
        };
        
        try {
          const response = await fetch(`/bloodBank/${bankId}/inventory`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
          });

          const result = await response.json();
          
          if (response.ok) {
            closeUpdateModal();
            window.location.href = '/bloodbank-dashboard?success=' + encodeURIComponent(result.message);
          } else {
            alert('Error: ' + result.message);
          }
        } catch (error) {
          alert('Error updating inventory: ' + error.message);
        }
      });

      // Handle bulk inventory update
      document.getElementById('bulkUpdateForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const inventoryUpdates = [];
        
        for (let [bloodGroup, quantity] of formData.entries()) {
          inventoryUpdates.push({ bloodGroup, quantity: parseInt(quantity) });
        }

        try {
          const response = await fetch(`/bloodBank/${bankId}/inventory/bulk`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ inventoryUpdates }),
          });

          const result = await response.json();
          
          if (response.ok) {
            closeBulkUpdateModal();
            window.location.href = '/bloodbank-dashboard?success=' + encodeURIComponent(result.message);
          } else {
            alert('Error: ' + result.message);
          }
        } catch (error) {
          alert('Error updating inventory: ' + error.message);
        }
      });
      // Donation Details Modal Functions
async function viewDonationDetails(donationId) {
  const modal = document.getElementById('donationDetailsModal');
  const content = document.getElementById('donationDetailsContent');
  
  modal.classList.remove('hidden');
  
  // Reset to loading state
  content.innerHTML = `
    <div class="text-center py-8">
      <svg class="animate-spin h-8 w-8 mx-auto text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      <p class="mt-2 text-gray-600">Loading donation details...</p>
    </div>
  `;
  
  try {
    const response = await fetch(`/donation/${donationId}`);
    const data = await response.json();
    
    if (response.ok && data.success && data.donation) {
      const donation = data.donation;
      const donor = donation.donor || {};
      const bloodBank = donation.bloodBank || {};
      
      // Format arrays for display
      const formatArray = (arr) => {
        if (!arr || !Array.isArray(arr) || arr.length === 0) return 'None';
        return arr.join(', ');
      };

      content.innerHTML = `
        <!-- Donor Information -->
        <div class="bg-gradient-to-r from-red-50 to-pink-50 rounded-lg p-6 border border-red-100">
          <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            Donor Information
          </h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <p class="text-sm text-gray-600">Full Name</p>
              <p class="font-semibold text-gray-800">${donor.fullName || 'N/A'}</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">Blood Group</p>
              <p class="font-semibold">
                <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm">${donation.bloodGroup || donor.bloodGroup || 'N/A'}</span>
              </p>
            </div>
            <div>
              <p class="text-sm text-gray-600">Phone</p>
              <p class="font-semibold text-gray-800">${donor.phone || 'N/A'}</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">Email</p>
              <p class="font-semibold text-gray-800">${donor.email || 'N/A'}</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">Date of Birth</p>
              <p class="font-semibold text-gray-800">${donor.dateOfBirth ? new Date(donor.dateOfBirth).toLocaleDateString() : 'N/A'}</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">Gender</p>
              <p class="font-semibold text-gray-800 capitalize">${donor.gender || 'N/A'}</p>
            </div>
            ${donor.donationCount !== undefined ? `
            <div>
              <p class="text-sm text-gray-600">Total Donations</p>
              <p class="font-semibold text-gray-800">${donor.donationCount}</p>
            </div>
            ` : ''}
          </div>
        </div>

        <!-- Address Information -->
        ${donor.address && (donor.address.street || donor.address.city || donor.address.state || donor.address.pincode) ? `
        <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
          <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            Address
          </h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            ${donor.address.street ? `
            <div class="md:col-span-2">
              <p class="text-sm text-gray-600">Street</p>
              <p class="font-semibold text-gray-800">${donor.address.street}</p>
            </div>
            ` : ''}
            ${donor.address.city ? `
            <div>
              <p class="text-sm text-gray-600">City</p>
              <p class="font-semibold text-gray-800">${donor.address.city}</p>
            </div>
            ` : ''}
            ${donor.address.state ? `
            <div>
              <p class="text-sm text-gray-600">State</p>
              <p class="font-semibold text-gray-800">${donor.address.state}</p>
            </div>
            ` : ''}
            ${donor.address.pincode ? `
            <div>
              <p class="text-sm text-gray-600">Pincode</p>
              <p class="font-semibold text-gray-800">${donor.address.pincode}</p>
            </div>
            ` : ''}
          </div>
        </div>
        ` : ''}

        <!-- Medical Information -->
        ${donor.medicalHistory && (donor.medicalHistory.diseases?.length > 0 || donor.medicalHistory.medications?.length > 0 || donor.medicalHistory.allergies?.length > 0 || donor.lastDonationDate) ? `
        <div class="bg-blue-50 rounded-lg p-6 border border-blue-100">
          <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            Medical Information
          </h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            ${donor.lastDonationDate ? `
            <div>
              <p class="text-sm text-gray-600">Last Donation Date</p>
              <p class="font-semibold text-gray-800">${new Date(donor.lastDonationDate).toLocaleDateString()}</p>
            </div>
            ` : ''}
            ${donor.medicalHistory.diseases && donor.medicalHistory.diseases.length > 0 ? `
            <div class="md:col-span-2">
              <p class="text-sm text-gray-600">Medical Conditions</p>
              <p class="font-semibold text-gray-800">${formatArray(donor.medicalHistory.diseases)}</p>
            </div>
            ` : ''}
            ${donor.medicalHistory.medications && donor.medicalHistory.medications.length > 0 ? `
            <div class="md:col-span-2">
              <p class="text-sm text-gray-600">Medications</p>
              <p class="font-semibold text-gray-800">${formatArray(donor.medicalHistory.medications)}</p>
            </div>
            ` : ''}
            ${donor.medicalHistory.allergies && donor.medicalHistory.allergies.length > 0 ? `
            <div class="md:col-span-2">
              <p class="text-sm text-gray-600">Allergies</p>
              <p class="font-semibold text-gray-800">${formatArray(donor.medicalHistory.allergies)}</p>
            </div>
            ` : ''}
          </div>
        </div>
        ` : ''}

        <!-- Donation Details -->
        <div class="bg-green-50 rounded-lg p-6 border border-green-100">
          <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            Donation Details
          </h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <p class="text-sm text-gray-600">Scheduled Date</p>
              <p class="font-semibold text-gray-800">${donation.donationDate ? new Date(donation.donationDate).toLocaleDateString() : 'N/A'}</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">Status</p>
              <p class="font-semibold">
                <span class="px-3 py-1 ${
                  donation.status === 'completed' ? 'bg-green-100 text-green-800' :
                  donation.status === 'scheduled' ? 'bg-blue-100 text-blue-800' :
                  donation.status === 'cancelled' ? 'bg-red-100 text-red-800' :
                  'bg-gray-100 text-gray-800'
                } rounded-full text-sm capitalize">${donation.status}</span>
              </p>
            </div>
            <div>
              <p class="text-sm text-gray-600">Quantity</p>
              <p class="font-semibold text-gray-800">${donation.quantity || 1} unit(s)</p>
            </div>
            ${donation.createdAt ? `
            <div>
              <p class="text-sm text-gray-600">Requested On</p>
              <p class="font-semibold text-gray-800">${new Date(donation.createdAt).toLocaleDateString()}</p>
            </div>
            ` : ''}
            ${donation.notes ? `
            <div class="md:col-span-2">
              <p class="text-sm text-gray-600">Notes</p>
              <p class="font-semibold text-gray-800">${donation.notes}</p>
            </div>
            ` : ''}
          </div>
        </div>

        <!-- Action Buttons -->
        ${donation.status === 'scheduled' ? `
        <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200">
          <form action="/donation/${donation._id}/status" method="POST" style="display: inline">
            <button
              type="submit"
              name="status"
              value="completed"
              class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium"
              onclick="return confirm('Mark this donation as completed? This will add ${donation.quantity || 1} unit(s) of ${donation.bloodGroup} to your inventory.')"
            >
              Mark as Completed
            </button>
          </form>
          <form action="/donation/${donation._id}/status" method="POST" style="display: inline">
            <button
              type="submit"
              name="status"
              value="cancelled"
              class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors font-medium"
              onclick="return confirm('Cancel this donation appointment?')"
            >
              Cancel Appointment
            </button>
          </form>
        </div>
        ` : ''}
      `;
    } else {
      content.innerHTML = `
        <div class="text-center py-8">
          <svg class="w-16 h-16 mx-auto text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <p class="mt-4 text-gray-600 font-medium">Donation details not found</p>
        </div>
      `;
    }
  } catch (error) {
    console.error('Error fetching donation details:', error);
    content.innerHTML = `
      <div class="text-center py-8">
        <svg class="w-16 h-16 mx-auto text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <p class="mt-4 text-gray-600 font-medium">Error loading donation details</p>
        <p class="mt-2 text-sm text-gray-500">${error.message}</p>
      </div>
    `;
  }
}

function closeDonationDetailsModal() {
  document.getElementById('donationDetailsModal').classList.add('hidden');
}

// Close modal on outside click
document.getElementById('donationDetailsModal')?.addEventListener('click', function(e) {
  if (e.target === this) {
    closeDonationDetailsModal();
  }
});
    </script>
    <script>
  // Auto-dismiss alerts after 3 seconds
  window.addEventListener('DOMContentLoaded', () => {
    const alerts = document.querySelectorAll('[role="alert"]');
    alerts.forEach(alert => {
      setTimeout(() => {
        alert.style.transition = 'opacity 0.5s ease-out';
        alert.style.opacity = '0';
        setTimeout(() => {
          alert.remove();
        }, 500);
      }, 3000);
    });
  });
</script>
  </body>
</html>